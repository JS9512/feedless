<form [formGroup]="actionsFg">
  <ion-row
    *ngFor="let actionFg of actionsFg.controls.actions.controls"
    formArrayName="actions"
  >
    <ion-col size="2">
      <app-select [items]="scrapeActionOptions"
                  [labelFn]="'label'"
                  (valueChanged)="actionFg.controls.type.setValue($event.key)"></app-select>
    </ion-col>
    <ion-col size="10" class="flex" [formGroup]="actionFg.controls.oneOf">
      <!-- click -->
      <div
        class="flex"
        formGroupName="click"
        *ngIf="actionFg.value.type === 'click'"
      >
        <app-select placeholder="Choose Action"
                    [labelFn]="'label'"
                    (valueChanged)="actionFg.controls.oneOf.controls.click.controls.type.setValue($event.key)"
                    [items]="clickTypes">
        </app-select>

        <ng-container
          *ngIf="
            actionFg.value.oneOf.click.type ===
            'element'
          "
        >
          <input type="text"
                 [formControl]="actionFg.controls.oneOf.controls.click.controls.oneOf.controls.selector"
                 placeholder="Button name (or XPath)"
                 pInputText />
          <ion-button
            [color]="
              getColorForControl(
                actionFg.controls.oneOf.controls.click.controls.oneOf.controls
                  .selector
              )
            "
            size="small"
            (click)="
              triggerPickElement(
                actionFg.controls.oneOf.controls.click.controls.oneOf.controls
                  .selector
              )
            "
          >
            {{ labelForXpath(fragmentFg.controls.xpath) }}
          </ion-button>
        </ng-container>

        <ng-container
          *ngIf="
            actionFg.value.oneOf.click.type ===
            'position'
          "
        >
          <input type="text"
                 [hidden]="actionFg.controls.oneOf.controls.click.controls.oneOf.controls.position.invalid"
                 [value]="
              formatPosition(
                actionFg.controls.oneOf.controls.click.controls.oneOf.controls
                  .position
              )
            "
                 placeholder="X/Y coordinates"
                 [readOnly]="true"
                 pInputText />

          <ion-button
            size="small"
            [color]="
              getColorForControl(
                actionFg.controls.oneOf.controls.click.controls.oneOf.controls
                  .position
              )
            "
            (click)="
              triggerPickPosition(
                actionFg.controls.oneOf.controls.click.controls.oneOf.controls
                  .position
              )
            "
          >
            Pick Position
          </ion-button>
        </ng-container>
      </div>

      <!-- cookie -->
      <div
        class="flex"
        formGroupName="cookie"
        *ngIf="actionFg.value.type === 'cookie'"
      >
        <input type="text"
               [formControl]="actionFg.controls.oneOf.controls.cookie.controls.text"
               placeholder="Set raw cookie string"
               pInputText />
      </div>

      <!-- wait -->
      <div
        class="flex"
        formGroupName="wait"
        *ngIf="actionFg.value.type === 'wait'"
      >
        <input type="text"
               [formControl]="actionFg.controls.oneOf.controls.wait.controls.selector"
               placeholder="XPath"
               pInputText />
        <ion-button
          color="light"
          size="small"
          (click)="
            triggerPickElement(
              actionFg.controls.oneOf.controls.wait.controls.selector
            )
          "
        >
          <ion-icon name="color-wand-outline"></ion-icon>
        </ion-button>
      </div>

      <!-- type -->
      <ng-container
        formGroupName="cookie"
        *ngIf="actionFg.value.type === 'type'"
      >
        <div class="flex">
          <input type="text"
                 formControlName="selector"
                 placeholder="XPath"
                 pInputText />

          <ion-button
            color="light"
            size="small"
            (click)="
              triggerPickElement(
                actionFg.controls.oneOf.controls.type.controls.selector
              )
            "
          >
            <ion-icon name="color-wand-outline"></ion-icon>
          </ion-button>
        </div>
        <div class="flex">
          <input type="text"
                 formControlName="text"
                 placeholder="Type here"
                 pInputText />
        </div>
      </ng-container>

      <!-- select -->
      <ng-container
        formGroupName="select"
        *ngIf="actionFg.controls.type.value === 'select'"
      >
        <div class="flex">
          <input type="text"
                 formControlName="selector"
                 placeholder="XPath"
                 pInputText />
          <ion-button
            color="light"
            size="small"
            (click)="
              triggerPickElement(
                actionFg.controls.oneOf.controls.select.controls.selector
              )
            "
          >
            <ion-icon name="color-wand-outline"></ion-icon>
          </ion-button>
        </div>
        <div class="flex">
          <input type="text"
                 formControlName="text"
                 placeholder="Value of Select"
                 pInputText />
        </div>
      </ng-container>

      <!-- header -->
      <ng-container
        formGroupName="header"
        *ngIf="actionFg.value.type === 'header'"
      >
        <div class="flex">
          <input type="text"
                 formControlName="name"
                 placeholder="Set Header name"
                 pInputText />
        </div>
        <div class="flex">
          <input type="text"
                 formControlName="text"
                 placeholder="Set Header value"
                 pInputText />
        </div>
      </ng-container>

      <ion-button
        aria-label="Remove"
        color="light"
        size="small"
        (click)="deleteAction(actionFg)"
      >
        <ion-icon name="trash-outline"></ion-icon>
      </ion-button>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col size="10">
      <ion-button
        size="small"
        color="light"
        (click)="addAction()"
      >
        <ion-icon name="add-outline"></ion-icon>
      </ion-button>
    </ion-col>
  </ion-row>


  <ion-row *ngIf="pickFragment" [formGroup]="fragmentFg">
    <ion-col size="12" class="flex">
      <ion-button color="primary" fill="clear">FRAGMENT FROM</ion-button>
      <!-- click -->
      <div class="flex">
        <app-select [labelFn]="'label'"
                    (valueChanged)="fragmentFg.controls.fragmentType.setValue($event.key)"
                    [items]="fragmentTypes">
        </app-select>

        <ng-container
          *ngIf="fragmentFg.value.fragmentType === 'element'"
        >
          <ion-button
            [color]="
            getColorForControl(fragmentFg.controls.xpath)
          "
            size="small"
            (click)="
            triggerPickElement(fragmentFg.controls.xpath)
          "
          >
            {{ labelForXpath(fragmentFg.controls.xpath) }}
          </ion-button>
          <ion-button *ngIf="fragmentFg.controls.xpath.valid"
                      color="light"
                      (click)="highlightXpath.emit(fragmentFg.value.xpath)">
            <ion-icon name="eye-outline"></ion-icon>
          </ion-button>

        </ng-container>

        <ng-container
          *ngIf="fragmentFg.controls.fragmentType.value === 'boundingBox'">
          <ion-button
            size="small"
            [color]="
            getColorForControl(fragmentFg.controls.boundingBox)
          "
            (click)="
            triggerPickBoundingBox(fragmentFg.controls.boundingBox)
          "
          >
            <ion-icon name="add-outline"
                      *ngIf="fragmentFg.controls.boundingBox.invalid"
                      slot="end"></ion-icon>
            {{ labelForBoundingBox(fragmentFg.controls.boundingBox) }}
          </ion-button>
          <ion-button *ngIf="fragmentFg.controls.boundingBox.valid"
                      color="light"
                      (click)="triggerHighlightBoundingBox(fragmentFg.value.boundingBox)">
            <ion-icon name="eye-outline"></ion-icon>
          </ion-button>

        </ng-container>
      </div>
    </ion-col>
  </ion-row>
</form>
