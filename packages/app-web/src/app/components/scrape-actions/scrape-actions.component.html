<form #formElement (change)="emitActions()">
  <ion-row
    *ngFor="let action of allActions"
  >
    <ion-col size="2">
      <app-select [items]="scrapeActionOptions"
                  [labelFn]="'label'"
                  (valueChanged)="action.type = $event.key"></app-select>
    </ion-col>
    <ion-col size="10" class="flex">
      <!-- click -->
      <div
        class="flex"
        *ngIf="action.type === 'click'"
      >
        <app-select placeholder="Choose Action"
                    [labelFn]="'label'"
                    (valueChanged)="action.oneOf.click.type = $event.key"
                    [items]="clickTypes">
        </app-select>

        <ng-container
          *ngIf="
            action.oneOf.click.type ===
            'element'
          "
        >
          <input type="text"
                 #clickSelector
                 [(ngModel)]="action.oneOf.click.oneOf.selector"
                 [hidden]="true"
                 [required]="true"
                 [minLength]="1"
                 placeholder="Button name (or XPath)"
                 pInputText />
          <ion-button
            [color]="
              getColorForControl(clickSelector.validity.valid)
            "
            size="small"
            (click)="
              triggerPickElement(
                action.oneOf.click.oneOf.selector
              )
            "
          >
            {{ labelForXpath(action.oneOf.click.oneOf.selector) }}
          </ion-button>
        </ng-container>

        <ng-container
          *ngIf="
            action.oneOf.click.type ===
            'position'
          "
        >
          <input type="text"
                 [hidden]="true"
                 #clickPosition
                 [value]="formatPosition(action.oneOf.click.oneOf.position)"
                 required
                 minlength="3" />
          <ion-button
            size="small"
            [color]="
              getColorForControl(clickPosition.validity.valid)
            "
            (click)="
              triggerPickPosition(
                action.oneOf.click.oneOf.position
              )
            "
          >
            {{ labelForPosition(action.oneOf.click.oneOf.position) }}
          </ion-button>
        </ng-container>
      </div>

      <!-- cookie -->
      <div
        class="flex"
        *ngIf="action.type === 'cookie'"
      >
        <input type="text"
               [(ngModel)]="action.oneOf.cookie.text"
               [required]="true"
               [minLength]="1"
               placeholder="Set raw cookie string"
               pInputText />
      </div>

      <!-- wait -->
      <div
        class="flex"
        *ngIf="action.type === 'wait'"
      >
        <input type="text"
               [(ngModel)]="action.oneOf.wait.selector"
               [required]="true"
               [minLength]="1"
               placeholder="XPath"
               pInputText />
        <ion-button
          color="light"
          size="small"
          (click)="
            triggerPickElement(action.oneOf.wait.selector)
          "
        >
          <ion-icon name="color-wand-outline"></ion-icon>
        </ion-button>
      </div>

      <!-- type -->
      <ng-container
        formGroupName="cookie"
        *ngIf="action.type === 'type'"
      >
        <div class="flex">
          <input type="text"
                 placeholder="XPath"
                 [(ngModel)]="action.oneOf.type.selector"
                 [required]="true"
                 [minLength]="1"
                 pInputText />

          <ion-button
            color="light"
            size="small"
            (click)="
              triggerPickElement(action.oneOf.type.selector)
            "
          >
            <ion-icon name="color-wand-outline"></ion-icon>
          </ion-button>
        </div>
        <div class="flex">
          <input type="text"
                 placeholder="Type here"
                 [(ngModel)]="action.oneOf.type.text"
                 [required]="true"
                 [minLength]="1"
                 pInputText />
        </div>
      </ng-container>

      <!-- select -->
      <ng-container
        *ngIf="action.type === 'select'"
      >
        <div class="flex">
          <input type="text"
                 [(ngModel)]="action.oneOf.select.selector"
                 [required]="true"
                 [minLength]="1"
                 placeholder="XPath"
                 pInputText />
          <ion-button
            color="light"
            size="small"
            (click)="
              triggerPickElement(action.oneOf.select.selector)
            "
          >
            <ion-icon name="color-wand-outline"></ion-icon>
          </ion-button>
        </div>
        <div class="flex">
          <input type="text"
                 placeholder="Value of Select"
                 [(ngModel)]="action.oneOf.select.text"
                 [required]="true"
                 [minLength]="1"
                 pInputText />
        </div>
      </ng-container>

      <!-- header -->
      <ng-container
        formGroupName="header"
        *ngIf="action.type === 'header'"
      >
        <div class="flex">
          <input type="text"
                 placeholder="Set Header name"
                 [(ngModel)]="action.oneOf.header.name"
                 [required]="true"
                 [minLength]="1"
                 pInputText />
        </div>
        <div class="flex">
          <input type="text"
                 placeholder="Set Header value"
                 [(ngModel)]="action.oneOf.header.text"
                 [required]="true"
                 [minLength]="1"
                 pInputText />
        </div>
      </ng-container>

      <ion-button
        aria-label="Remove"
        color="light"
        size="small"
        (click)="deleteAction(action)"
      >
        <ion-icon name="trash-outline"></ion-icon>
      </ion-button>
    </ion-col>
  </ion-row>
  <ion-row>
    <ion-col size="10">
      <ion-button
        size="small"
        color="light"
        (click)="addAction()"
      >
        <ion-icon name="add-outline"></ion-icon>
      </ion-button>
    </ion-col>
  </ion-row>


<!--  <ion-row *ngIf="pickFragment" [formGroup]="fragmentFg">-->
<!--    <ion-col size="12" class="flex">-->
<!--      <ion-button color="primary" fill="clear">FRAGMENT FROM</ion-button>-->
<!--      &lt;!&ndash; click &ndash;&gt;-->
<!--      <div class="flex">-->
<!--        <app-select [labelFn]="'label'"-->
<!--                    (valueChanged)="fragmentFg.controls.fragmentType.setValue($event.key)"-->
<!--                    [items]="fragmentTypes">-->
<!--        </app-select>-->

<!--        <ng-container-->
<!--          *ngIf="fragmentFg.value.fragmentType === 'element'"-->
<!--        >-->
<!--          <ion-button-->
<!--            [color]="-->
<!--            getColorForControl(fragmentFg.controls.xpath)-->
<!--          "-->
<!--            size="small"-->
<!--            (click)="-->
<!--            triggerPickElement(fragmentFg.controls.xpath)-->
<!--          "-->
<!--          >-->
<!--            {{ labelForXpath(fragmentFg.controls.xpath) }}-->
<!--          </ion-button>-->
<!--          <ion-button *ngIf="fragmentFg.controls.xpath.valid"-->
<!--                      color="light"-->
<!--                      (click)="highlightXpath.emit(fragmentFg.value.xpath)">-->
<!--            <ion-icon name="eye-outline"></ion-icon>-->
<!--          </ion-button>-->

<!--        </ng-container>-->

<!--        <ng-container-->
<!--          *ngIf="fragmentFg.controls.fragmentType.value === 'boundingBox'">-->
<!--          <ion-button-->
<!--            size="small"-->
<!--            [color]="-->
<!--            getColorForControl(fragmentFg.controls.boundingBox)-->
<!--          "-->
<!--            (click)="-->
<!--            triggerPickBoundingBox(fragmentFg.controls.boundingBox)-->
<!--          "-->
<!--          >-->
<!--            <ion-icon name="add-outline"-->
<!--                      *ngIf="fragmentFg.controls.boundingBox.invalid"-->
<!--                      slot="end"></ion-icon>-->
<!--            {{ labelForBoundingBox(fragmentFg.controls.boundingBox) }}-->
<!--          </ion-button>-->
<!--          <ion-button *ngIf="fragmentFg.controls.boundingBox.valid"-->
<!--                      color="light"-->
<!--                      (click)="triggerHighlightBoundingBox(fragmentFg.value.boundingBox)">-->
<!--            <ion-icon name="eye-outline"></ion-icon>-->
<!--          </ion-button>-->

<!--        </ng-container>-->
<!--      </div>-->
<!--    </ion-col>-->
<!--  </ion-row>-->
</form>

{{ formElement.checkValidity() }}
