<div class="flex__column">
  <div *ngIf="!hideSearchBar">
    <ion-toolbar style="padding: 10px">
      <app-searchbar
        (querySubmit)="handleQuery($event)"
        [value]="url"
        [loading]="loading"
        (cancelReceived)="handleCancel()"
        buttonText="Go"
        [color]="url?.length > 0 ? undefined : 'primary'"
        placeholder="Type a Url of a website"
      ></app-searchbar>
      <ng-container *ngIf="errorMessage">
        <p style="color: var(--ion-color-danger)" class="ion-margin">
          We ran into a problem! {{ errorMessage }}.
        </p>
        <p class="ion-margin">
          Some errors can be resolved by
          <a href="javascript:void(0)" (click)="showActionsModal()"
            >enabling JavaScript</a
          >
        </p>
      </ng-container>
    </ion-toolbar>
  </div>

  <div class="flex">
    <div *ngIf="loading" class="ion-margin">
      <ion-spinner name="dots"></ion-spinner>
    </div>

    <div *ngIf="!scrapeResponse && repositories.length > 0" class="ion-padding" style="width: 100%">
      <p>Remix existing feeds</p>
      <ion-list>
        <ion-item *ngFor="let r of repositories"
                  [button]="true"
                  (click)="remix(r)">
          {{r.title}}
        </ion-item>
      </ion-list>
    </div>

    <app-transform-website-to-feed
      #webToFeedTransformer
      (selectedFeedChange)="selectedFeed = $event"
      (statusChange)="hasFeed = $event === 'valid'"
      *ngIf="scrapeResponse"
      [scrapeRequest]="scrapeRequest"
      [scrapeResponse]="scrapeResponse"
    >
      <ion-item
        (click)="showActionsModal()"
        class="cy-enable-js-button"
        [button]="true"
        topSlot
      >
        Enable JavaScript
        <ion-icon name="logo-javascript" color="warning" slot="end"></ion-icon>
      </ion-item>
      <ion-item
        (click)="showTagsModal()"
        class="cy-enable-js-button"
        [button]="true"
        topSlot
      >
        <ion-label>
          Source Tags
          <ion-note *ngIf="tags.length > 0">{{ getTagsString() }}</ion-note>
        </ion-label>
        <ion-icon
          name="pricetags-outline"
          color="primary"
          slot="end"
        ></ion-icon>
      </ion-item>
      <ion-item
        (click)="showLocationPickerModal()"
        class="cy-enable-js-button"
        [button]="true"
        topSlot
      >
        <ion-label>
          Geo Tag

          <ion-note *ngIf="!location">None</ion-note>
          <ion-note *ngIf="location"
            >({{ location.lat }}/{{ location.lon }})</ion-note
          >
        </ion-label>
        <ion-icon name="location-outline" color="primary" slot="end"></ion-icon>
      </ion-item>
      <!--      <ion-item-->
      <!--        *ngIf="selectedFeed?.nativeFeed"-->
      <!--        [button]="true"-->
      <!--        topSlot-->
      <!--      >-->
      <!--        <ion-checkbox slot="start"></ion-checkbox>-->
      <!--        <ion-label>-->
      <!--          Inherit categories-->
      <!--        </ion-label>-->
      <!--        <ion-icon-->
      <!--          name="link-outline"-->
      <!--          color="primary"-->
      <!--          slot="end"-->
      <!--        ></ion-icon>-->
      <!--      </ion-item>-->
      <ion-item
        (click)="finalizeFeed()"
        [button]="true"
        [color]="hasFeed ? 'success' : 'medium'"
        bottomSlot
      >
        {{ submitButtonText }}
        <ion-icon name="checkmark-outline" slot="end"></ion-icon>
      </ion-item>
    </app-transform-website-to-feed>
  </div>
</div>
