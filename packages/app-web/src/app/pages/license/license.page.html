<ion-content>
  <div class="limited-width-pane" style="margin-top: 100px">
    <ion-list>
      <ion-item>
        <h2>Your License</h2>
      </ion-item>
      <ion-item>
        <p>
          After the 2 month trial period, you need a license key to keep the
          system running. Open Source is dead, unless you carry your end of
          the couch :)
        </p>
      </ion-item>

      <ion-spinner name="dots" *ngIf="loading"></ion-spinner>

      <ng-container *ngIf="!loading">
        <ion-item *ngIf="license.isValid && !license.isTrial" color="success">
          <p>No License needed, its now Apache 2</p>
        </ion-item>

        <div style="position: relative">
          <ion-item
            *ngIf="license.isValid && license.isTrial && !license.isLocated"
            style="--background: transparent"
          >
            <ion-icon name="time-outline" slot="start"></ion-icon>
            <p>
              Trial period {{fromNow(license.trialUntil)}} (until
              {{license.trialUntil | date: dateFormat}})
            </p>
          </ion-item>
          <ion-progress-bar
            [value]="getRelativeTrialDaysLeft()"
            color="danger"
            style="
                height: 100%;
                position: absolute;
                width: 100%;
                opacity: 0.5;
                top: 0;
              "
          ></ion-progress-bar>
        </div>

        <ng-container *ngIf="!license.isLocated">
          <ion-item *ngIf="!license.isValid" color="warning">
            <p>No License found</p>
          </ion-item>
        </ng-container>
        <ng-container *ngIf="license.isLocated">
          <ion-item *ngIf="license.isValid" color="success">
            <ion-icon name="checkmark-done-outline" slot="start"></ion-icon>
            <p>Licenced to <strong>{{license.data?.name}}</strong></p>
          </ion-item>
          <ion-item *ngIf="!license.isValid" color="warning">
            <ion-icon name="alert-outline" slot="start"></ion-icon>
            <p>{{license.data?.name}}</p>
            <p>License is invalid</p>
          </ion-item>
        </ng-container>

        <ion-item class="ion-margin-top">
          <h3>Pricing</h3>
        </ion-item>
        <ion-item>
          <!--            <p>-->
          <!--              If the asked price is too high, you are a student, you do Open-->
          <!--              Source yourself, etc.-->
          <!--              <strong>negotiate with me</strong>-->
          <!--            </p>-->
          <p>
            Here <strong>Release</strong> signifies major release. There will be at most one major release per year.
          </p>
        </ion-item>
        <div class="plans">
          <app-plan-column
            [price]="'$' + price"
            style="--color: var(--ion-color-primary)"
            pricePerUnit="/ Release"
            [featureGroups]="featureGroupsRP"
          >
            <div planHeader>
              <div>
                <strong>RSS-Proxy</strong>
              </div>
              <ion-note>Individual, Self Hosted</ion-note>
            </div>

            <div>
              <div>2nd consecutive releases</div>
              <div style="font-weight: bold">
                <h1 style="display: inline-block; font-weight: bold;">
                  ${{ discount(30) }}
                  <div class="discount-tag">-30%</div>
                </h1>
                <ion-note> / release</ion-note>
              </div>
            </div>
            <div>
              <div>then consecutive releases</div>
              <div style="font-weight: bold">
                <h1 style="display: inline-block; font-weight: bold;">
                  ${{ discount(50) }}
                  <div class="discount-tag">-50%</div>
                </h1>
                <ion-note> / release</ion-note>
              </div>
            </div>

            <ion-button
              planAction
              color="primary"
              expand="block"
              (click)="openBuyModal()"
            >
              Buy Now
            </ion-button>
          </app-plan-column>

          <app-plan-column
            price="$199.68"
            style="--color: #ccc; opacity: 0.8"
            pricePerUnit="/ Year"
            [featureGroups]="featureGroupsRA"
          >
            <div planHeader>
              <div>
                <strong>rss.app</strong>
              </div>
              <ion-note>Developer, Cloud</ion-note>
            </div>
          </app-plan-column>
        </div>
        <!--          <ion-item class="ion-margin-top">-->
        <!--            <h3>Online Activation</h3>-->
        <!--          </ion-item>-->
        <!--          <ion-item color="primary" [disabled]="true">-->
        <!--            <ion-icon name="arrow-forward-outline" slot="start"></ion-icon>-->
        <!--            Buy license now!-->
        <!--          </ion-item>-->
        <ng-container *ngIf="!license.isValid || license.isTrial">
          <ion-item class="ion-margin-top">
            <h3>Offline Activation</h3>
          </ion-item>
          <ion-item>
            <p>
              Paste the license key in here and you will see an immediate
              response.
            </p>
          </ion-item>
          <ion-item>
            <ion-textarea
              style="--padding-start: 10px"
              placeholder="Your License Key"
              #licenseField
              rows="5"
              fill="outline"
              [autoGrow]="true"
            ></ion-textarea>
          </ion-item>
          <ion-row>
            <ion-col style="padding: 10px">
              <ion-button
                color="primary"
                expand="block"
                (click)="applyLicense(licenseField.value)"
              >
                Activate Now
              </ion-button>
            </ion-col>
          </ion-row>
        </ng-container>
      </ng-container>
    </ion-list>
  </div>
</ion-content>
