<!--<ion-header>-->
<!--  <ion-toolbar>-->
<!--    <ion-buttons slot="start">-->
<!--      <ion-button (click)="dismissModal()">-->
<!--        <ion-icon name="close-outline"></ion-icon>-->
<!--      </ion-button>-->
<!--    </ion-buttons>-->
<!--    <ion-title>Actions</ion-title>-->
<!--    <ion-buttons slot="end">-->
<!--      <ion-button color="success" expand="full" fill="solid" (click)="applyChanges()">-->
<!--        Apply-->
<!--      </ion-button>-->
<!--    </ion-buttons>-->
<!--  </ion-toolbar>-->
<!--</ion-header>-->
<ion-content>
  <form (ngSubmit)="scrape()">
    <ion-toolbar color="danger">
      <ion-label class="ion-margin-horizontal"
                 *ngIf="errorMessage">{{ errorMessage }}. Please try later.</ion-label>
    </ion-toolbar>
    <ion-row
      [ngClass]="{ 'busy-cursor': busy, 'website--pick-mode': isPickMode() }"
      class="website flex_column"
    >
      <div *ngIf="!embedScreenshot" style="margin: auto">
        <div *ngIf="busy">Loading Screenshot...</div>
      </div>

      <app-embedded-image
        (pickedPosition)="handlePickedPosition($event)"
        *ngIf="embedScreenshot"
        [embed]="embedScreenshot"
        [pickPosition]="isPickMode()"
        strokeStyle="red"
      ></app-embedded-image>
    </ion-row>
    <ion-row *ngIf="isPickMode()">
      <ion-item color="primary" style="width: 100%">
        <ion-label> Click on your element of choice </ion-label>
        <ion-button (click)="cancelPickMode()" color="dark" slot="end"
          >Cancel</ion-button
        >
      </ion-item>
    </ion-row>
    <ion-row *ngIf="!isPickMode()" class="actions">
      <ion-progress-bar
        *ngIf="busy"
        color="medium"
        type="indeterminate"
      ></ion-progress-bar>
      <ion-list class="flex__column">
        <ion-item *ngFor="let action of getActions(); let i = index">
          <div class="flex__row">
            <div>
              <ion-select
                [formControl]="action.controls.type"
                fill="outline"
                interface="popover"
                placeholder="Action"
              >
                <ion-select-option value="click">Click</ion-select-option>
              </ion-select>
            </div>

            <ion-button
              (click)="pickPosition(action)"
              [ngClass]="{ 'ng-invalid': action.invalid }"
              color="medium"
              expand="block"
              fill="outline"
              style="flex: 1"
            >
              {{ getPositionLabel(action) }}
            </ion-button>

            <ion-button (click)="removeAction(i)" color="medium" fill="clear">
              <ion-icon name="trash-outline"></ion-icon>
            </ion-button>
          </div>
        </ion-item>
        <ion-item *ngIf="actions.length < 4" [disabled]="actions.invalid">
          <ion-label>
            <a (click)="addAction()" href="javascript:void(0)">Add Action</a>
          </ion-label>
        </ion-item>
      </ion-list>
    </ion-row>
  </form>
</ion-content>
<ion-footer *ngIf="!isPickMode()">
  <ion-toolbar>
    <ion-buttons slot="end">
      <ion-button (click)="dismissModal()"> Cancel </ion-button>
      <ion-button
        (click)="applyChanges()"
        [disabled]="busy || errorMessage || !scrapeResponse || actions.invalid"
        color="success"
        expand="full"
        fill="solid"
      >
        Apply
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>
