<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="closeModal()">
        <ion-icon name="close-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>{{ modalTitle }}</ion-title>
    <ion-buttons slot="end">
      <ion-button
        (click)="createOrUpdateFeed()"
        *ngIf="!loading"
        fill="solid"
        color="success"
      >
        <ion-label *ngIf="isLoggedIn">
          <span *ngIf="isUpdate()">Update</span>
          <span *ngIf="!isUpdate()">Create</span>
          Feed
        </ion-label>
        <ion-label *ngIf="!isLoggedIn">
          <span *ngIf="isUpdate()">Update</span>
          <span *ngIf="!isUpdate()">Create</span>
          Trial Feed
        </ion-label>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
<ion-content>
  <app-remote-feed-preview #remoteFeedPreviewComponent>
    <ion-list>
      <ion-item>
        <ion-label>Feed Title</ion-label>
      </ion-item>
      <ion-item>
        <ion-input
          [formControl]="formFg.controls.title"
          fill="outline"
          placeholder="Type a title"
          aria-label="Title"
        ></ion-input>
      </ion-item>
      <ion-item>
        <ion-label>Description (optional)</ion-label>
      </ion-item>
      <ion-item>
        <ion-textarea
          [autoGrow]="true"
          rows="3"
          fill="outline"
          placeholder="#tags, urls,..."
          [formControl]="formFg.controls.description"
          aria-label="Describe the feed with #tags and urls"
        ></ion-textarea>
      </ion-item>
      <ion-item>
        <ion-label>Fetch Frequency</ion-label>
      </ion-item>
      <ion-item>
        <ion-select
          [formControl]="formFg.controls.fetchFrequency"
          fill="outline"
          interface="popover"
        >
          <ion-select-option [disabled]="isThrottled" value="0 */15 * * * *"
            >Every 15 min
          </ion-select-option>
          <ion-select-option [disabled]="isThrottled" value="0 */30 * * * *"
            >Every 30 min
          </ion-select-option>
          <ion-select-option [disabled]="isThrottled" value="0 0 * * * *"
            >Every hour
          </ion-select-option>
          <ion-select-option [disabled]="isThrottled" value="0 0 */8 * * *"
            >Every 6 hours
          </ion-select-option>
          <ion-select-option [disabled]="isThrottled" value="0 0 */12 * * *"
            >Every 12 hours
          </ion-select-option>
          <ion-select-option value="0 0 0 * * *">Every Day</ion-select-option>
          <ion-select-option value="0 0 0 * * 0">Every Week</ion-select-option>
        </ion-select>
      </ion-item>
    </ion-list>

    <ion-list class="filters">
      <ion-item>
        <ion-label>
          Filters
          <a
            (click)="addFilter()"
            *ngIf="filters.length === 0"
            href="javascript:void(0)"
          >
            Add Filter
          </a>
        </ion-label>
      </ion-item>

      <div
        *ngFor="let filter of filters; let i = index"
        class="flex ion-margin-bottom ion-margin-start ion-align-items-center"
      >
        <ion-select
          [formControl]="filter.controls.type"
          fill="outline"
          interface="popover"
        >
          <ion-select-option [value]="FilterTypeInclude"
            >include</ion-select-option
          >
          <ion-select-option [value]="FilterTypeExclude"
            >exclude</ion-select-option
          >
        </ion-select>
        <ion-text class="ion-padding-end"> if </ion-text>
        <ion-select
          [formControl]="filter.controls.field"
          fill="outline"
          interface="popover"
        >
          <ion-select-option [value]="FilterFieldLink">link</ion-select-option>
          <ion-select-option [value]="FilterFieldTitle"
            >title</ion-select-option
          >
          <ion-select-option [value]="FilterFieldContent"
            >content</ion-select-option
          >
        </ion-select>
        <ion-select
          [formControl]="filter.controls.operator"
          fill="outline"
          interface="popover"
        >
          <ion-select-option [value]="GqlStringFilterOperator.Contains"
            >contains</ion-select-option
          >
          <ion-select-option [value]="GqlStringFilterOperator.Matches"
            >matches</ion-select-option
          >
          <ion-select-option [value]="GqlStringFilterOperator.StartsWidth"
            >starts with</ion-select-option
          >
          <ion-select-option [value]="GqlStringFilterOperator.EndsWith"
            >ends with</ion-select-option
          >
        </ion-select>
        <ion-input
          [formControl]="filter.controls.value"
          placeholder="Type a value"
          fill="outline"
        ></ion-input>

        <ion-button (click)="removeFilter(i)" color="medium" fill="clear">
          <ion-icon name="trash-outline"></ion-icon>
        </ion-button>
      </div>
      <div class="ion-padding-start">
        <a
          (click)="addFilter()"
          *ngIf="filters.length > 0 && filters.length < 4"
          href="javascript:void(0)"
        >
          Add Filter
        </a>
      </div>
    </ion-list>

    <ion-list>
      <ion-item>
        <ion-label>
          Retention Strategy
          <a
            (click)="showRetention = !showRetention"
            *ngIf="!showRetention"
            href="javascript:void(0)"
          >
            Customize
          </a>
        </ion-label>
      </ion-item>
      <ion-item *ngIf="showRetention">
        <ion-input
          label="Delete after days"
          labelPlacement="start"
          fill="outline"
          [formControl]="formFg.controls.maxAgeDays"
          [clearInput]="true"
          placeholder="<Auto>"
        ></ion-input>
      </ion-item>
      <ion-item *ngIf="showRetention">
        <ion-input
          label="Keep max items"
          labelPlacement="start"
          fill="outline"
          [formControl]="formFg.controls.maxItems"
          [clearInput]="true"
          placeholder="<Auto>"
        ></ion-input>
      </ion-item>
    </ion-list>

    <ion-list>
      <ion-item>
        <ion-label>Visibility</ion-label>
      </ion-item>

      <ion-item>
        <ion-checkbox
          labelPlacement="end"
          justify="start"
          [formControl]="formFg.controls.isPublic"
        >
          Public
          <ion-note class="ion-padding-horizontal"
            >Eveyrone can see the feed url and sources</ion-note
          >
        </ion-checkbox>
      </ion-item>
    </ion-list>

    <ion-list>
      <ion-item>
        <ion-label>Plugins</ion-label>
      </ion-item>

      <ion-item>
        <ion-checkbox
          labelPlacement="end"
          justify="start"
          [formControl]="formFg.controls.applyFulltextPlugin"
        >
          Fulltext
          <ion-note class="ion-padding-horizontal"
            >Fetch Fulltext for every Item (static only)</ion-note
          >
        </ion-checkbox>
      </ion-item>
      <ion-item>
        <ion-checkbox
          labelPlacement="end"
          justify="start"
          [formControl]="formFg.controls.applyPrivacyPlugin"
        >
          Privacy & Robustness
          <ion-note class="ion-padding-horizontal"
            >Inlines images (base64) and unwinds tracking urls</ion-note
          >
        </ion-checkbox>
      </ion-item>
    </ion-list>
  </app-remote-feed-preview>
</ion-content>
